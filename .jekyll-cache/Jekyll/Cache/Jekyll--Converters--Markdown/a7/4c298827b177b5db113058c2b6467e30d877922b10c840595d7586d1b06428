I"6€<h2 id="exercise">Exercise</h2>

<blockquote>
  <p>&gt; o &lt; !<br />
Download</p>
</blockquote>

<p><img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/exercise.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] exercise</i></p>

<h2 id="solution">Solution</h2>

<p>í’€ì´ìê°€ ë§ì•„ì„œ, ì‹œê°„ ë‚ ë•Œ ë´¤ë˜ ë¬¸ì œ.. í•˜ì§€ë§Œ Smail code ë•Œë§¤ ì œëŒ€ë¡œ code ë³´ì§ˆ ëª»í–ˆëŠ”ë°, ë‚˜ì¤‘ì— ë‹¤ë¥¸ ë„êµ¬ ì¨ë³´ë‹ˆ ì˜ë˜ì„œ ë¹¡ì¹œ ë¬¸ì œ..</p>

<p>zip íŒŒì¼ì„ ë‹¤ìš´ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì••ì¶• í•´ì œ ì‹œ APK íŒŒì¼ì„ í•˜ë‚˜ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/apk.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] apk binary</i></p>

<p>ADBì— ì˜¬ë ¤, ë¨¼ì € ì„¤ì¹˜ë¥¼ ì§„í–‰í•œë‹¤. íŒ€ì›ë“¤ì´ ì„¤ì¹˜ê°€ ì œëŒ€ë¡œ ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í–ˆì—ˆëŠ”ë°, ë³„ë‹¤ë¥¸ ì—ëŸ¬ ì—†ì´ ì„¤ì¹˜ê°€ ì§„í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/1.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] apk install</i></p>

<p>ì„¤ì¹˜ëœ apkë¥¼ ì‹¤í–‰ì‹œì¼œ ë³´ë©´, ì•„ë˜ì™€ ê°™ì€ id input í•­ëª©ê³¼ <code class="highlighter-rouge">next</code> ë²„íŠ¼ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/2.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] apk execute (MainActivity)</i></p>

<p>ì•„ë¬´ ê°’ìœ¼ë¡œ id í•­ëª©ì„ ì…ë ¥í•˜ê³ , next ë²„íŠ¼ì„ ëˆ„ë¥¼ ê²½ìš° ì•„ë˜ì™€ ê°™ì´ pw ì…ë ¥ ë ˆì´ì•„ì›ƒ(Main2Activity)ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, password ë¥¼ ì•„ë¬´ê°’ìœ¼ë¡œ ì…ë ¥í•˜ê³  nextë¥¼ ëˆŒëŸ¬ popupë˜ëŠ” ë¬¸êµ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/3.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] apk execute (Main2Activity)</i></p>

<p>ì£¼ì–´ì§„ ì¡°ê±´ì„ ì¶©ì¡±ì‹œì¼œ ì¤˜ì•¼í•˜ëŠ” ë¬¸ì œì¸ì§€, ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•´ì•¼í•˜ëŠ” ë¬¸ì œì¸ì§€ í™•ì¸í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œ, APKë¥¼ decompile í•  í•„ìš”ê°€ ìˆëŠ”ë° í‰ì†Œì— ë³¸ì¸ì€ <code class="highlighter-rouge">BytecodeViewer</code>ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, <code class="highlighter-rouge">apktool + BytecodeViewer</code> ì¡°í•©ìœ¼ë¡œ APK ë¶„ì„ì„ ìì£¼í•˜ëŠ” í¸ì´ë¼ ì´ë²ˆì—ë„ ë™ì¼í•˜ê²Œ ì§„í–‰í–ˆë‹¤.</p>

<blockquote>
  <p>BytecodeViewerë¡œë§Œ í•´ë‹¹ apkë¥¼ ì—´ ê²½ìš°, ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì§€ ì•ŠëŠ”ë‹¤. (Null Point Exception error)</p>
</blockquote>

<p><img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/bytecodeviewer.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] BytecodeViewer Error</i></p>

<blockquote>
  <p>ë”°ë¼ì„œ, apktoolì„ ì´ìš©í•´ decompileì„ ë¨¼ì € ì§„í–‰í•˜ê³ , BytecodeViewerë¥¼ ì´ìš©í•´ apk êµ¬ì„±ìš”ì†Œë“¤ì„ ì‚´í´ë³´ì•˜ë‹¤. ì•„ë˜ì™€ ê°™ì´ smali ê°€ ê·¸ëŒ€ë¡œ ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆëŠ”ë°, ëŒ€íšŒ ë‹¹ì‹œì— ëŠ¦ê²Œ ì°¸ì—¬í•˜ê³  ì—¬ëŸ¬ ì¼ì • ì†Œí™”í•˜ê³  ì˜¨í„°ë¼ í”¼ê³¤í•œ ìƒíƒœì—ì„œ ì„±ì˜ê» ë³´ì§€ ì•Šì€ ì ì´ íŒ¨ì¸ì´ë‹¤â€¦(ë³€ëª…ã…‹)</p>
  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Codegate_CTF/ë¬¸ì œë°±ì—…/[Rev]Welcome to droidî‚°
î‚° apktool d ./droid.apk
I: Using Apktool 2.3.1 on droid.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
S: WARNING: Could not write to <span class="o">(</span>/Users/Mac/Library/apktool/framework<span class="o">)</span>, using /var/folders/t_/3_spx9kn2j1072knxbnnwlvm0000gn/T/ instead...
S: Please be aware this is a volatile directory and frameworks could go missing, please utilize <span class="nt">--frame-path</span> <span class="k">if </span>the default storage directory is unavailable
I: Loading resource table from file: /var/folders/t_/3_spx9kn2j1072knxbnnwlvm0000gn/T/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values <span class="k">*</span>/<span class="k">*</span> XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
</code></pre></div>  </div>
</blockquote>

<p><img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/decompile_smali.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] decompile_smali</i></p>

<p>ì´ê²Œ, apktool ë¡œ decompile í–ˆì„ ë• smaliê°€ ë•ì§€ë•ì§€ ë¶™ì–´ë‚˜ì™€ì„œ ì˜ ë³´ê¸° ë¶ˆí¸í–ˆëŠ”ë° <code class="highlighter-rouge">jadx-gui</code>ë¥¼ ì´ìš©í•´ì„œ í•´ë‹¹ apkë¥¼ ì—´ì—ˆì„ ë•, ì•„ë˜ì™€ ê°™ì´ ê¹”ë”í•˜ê²Œ Codeë¥¼ ë³¼ ìˆ˜ ìˆì—ˆë‹¤..
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/jadx_decompile.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] decompile jadx</i></p>

<p>Code íë¦„ì„ ì‚´í´ë³´ì, ì•„ë˜ëŠ” MainActivity code ì´ë‹¤. id input ê°’ì˜ ê¸¸ì´ë¥¼ ì²´í¬í•˜ê³ , Main2Activityë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"enter your id"</span><span class="o">);</span>
        <span class="o">((</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button2</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="nc">MainActivity</span> <span class="n">a</span><span class="o">;</span>

            <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">r1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">26</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span> <span class="nc">Main2Activity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"edittext"</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre></div></div>
<p><br /></p>

<p>Main2Activityë¡œ ê°€ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ password ì— ëŒ€í•œ value checkì„ í†µí•´ì„œ Main3Activityë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"enter your password"</span><span class="o">);</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">stringExtra</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getStringExtra</span><span class="o">(</span><span class="s">"edittext"</span><span class="o">);</span>
        <span class="o">((</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button2</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="nc">Main2Activity</span> <span class="n">b</span><span class="o">;</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Main2Activity</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">stringExtra</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">obj</span><span class="o">))</span> <span class="o">{</span>
                    <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span> <span class="nc">Main3Activity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">stringExtra</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"pass"</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="o">((</span><span class="nc">TextView</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sample_text</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="s">"wrong! try again"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre></div></div>
<p><br /></p>

<p>Main3Activityë¡œ ê°€ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ serial keyì— ëŒ€í•œ value checkì„ í†µí•´ì„œ Main4Activityë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. k methodë¡œë¶€í„° ìƒì„±ë˜ëŠ” ë¬¸ìì—´ê³¼ ë¹„êµë¥¼ í•˜ëŠ” ê³¼ì •ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ë°, radom stringì´ generate ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main3Activity</span> <span class="kd">extends</span> <span class="n">c</span> <span class="o">{</span>
    <span class="nc">EditText</span> <span class="n">l</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">cArr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[]{</span><span class="sc">'a'</span><span class="o">,</span> <span class="sc">'b'</span><span class="o">,</span> <span class="sc">'c'</span><span class="o">,</span> <span class="sc">'d'</span><span class="o">,</span> <span class="sc">'e'</span><span class="o">,</span> <span class="sc">'f'</span><span class="o">,</span> <span class="sc">'g'</span><span class="o">,</span> <span class="sc">'h'</span><span class="o">,</span> <span class="sc">'i'</span><span class="o">,</span> <span class="sc">'j'</span><span class="o">,</span> <span class="sc">'k'</span><span class="o">,</span> <span class="sc">'l'</span><span class="o">,</span> <span class="sc">'m'</span><span class="o">,</span> <span class="sc">'n'</span><span class="o">,</span> <span class="sc">'o'</span><span class="o">,</span> <span class="sc">'p'</span><span class="o">,</span> <span class="sc">'q'</span><span class="o">,</span> <span class="sc">'r'</span><span class="o">,</span> <span class="sc">'s'</span><span class="o">,</span> <span class="sc">'t'</span><span class="o">,</span> <span class="sc">'u'</span><span class="o">,</span> <span class="sc">'v'</span><span class="o">,</span> <span class="sc">'w'</span><span class="o">,</span> <span class="sc">'x'</span><span class="o">,</span> <span class="sc">'y'</span><span class="o">,</span> <span class="sc">'z'</span><span class="o">,</span> <span class="sc">'0'</span><span class="o">,</span> <span class="sc">'1'</span><span class="o">,</span> <span class="sc">'2'</span><span class="o">,</span> <span class="sc">'3'</span><span class="o">,</span> <span class="sc">'4'</span><span class="o">,</span> <span class="sc">'5'</span><span class="o">,</span> <span class="sc">'6'</span><span class="o">,</span> <span class="sc">'7'</span><span class="o">,</span> <span class="sc">'8'</span><span class="o">,</span> <span class="sc">'9'</span><span class="o">};</span>
        <span class="nc">StringBuffer</span> <span class="n">stringBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="nc">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cArr</span><span class="o">[</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">cArr</span><span class="o">.</span><span class="na">length</span><span class="o">)]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">stringBuffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main3</span><span class="o">);</span>
        <span class="n">a</span><span class="o">((</span><span class="nc">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">));</span>
        <span class="o">((</span><span class="nc">FloatingActionButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fab</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="nc">Main3Activity</span> <span class="n">a</span><span class="o">;</span>

            <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">r1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Snackbar</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"Replace with your own action"</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">a</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">).</span><span class="na">a</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">k</span><span class="o">())</span> <span class="o">{</span>
            <span class="o">((</span><span class="nc">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sample_text</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="s">"hi there"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sample_text</span><span class="o">);</span>
            <span class="n">finishAffinity</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">l</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"type serial key"</span><span class="o">);</span>
        <span class="o">((</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button2</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="nc">Main3Activity</span> <span class="n">a</span><span class="o">;</span>

            <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">r1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">k</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">()))</span> <span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getContext</span><span class="o">(),</span> <span class="nc">Main4Activity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="o">((</span><span class="nc">TextView</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sample_text</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="s">"wrong! try again"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
ì•„ë˜ëŠ” Main4Activity Codeì´ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ Main3Activity ê¹Œì§€ ì…ë ¥í•œ ID, PW, Serial keyê°€ checkì— ë¶€í•©ë˜ëŠ” ê²½ìš° Main4Activityë¥¼ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ì¸ë°, ìì„¸íˆ ë³´ë©´, <code class="highlighter-rouge">this.l.setText(stringFromJNI());</code>ì—ì„œ JNI()ë¥¼ í†µí•´ í˜¸ì¶œí•œ ê°’ì„ setText ë¥¼ í†µí•´ì„œ ë¿Œë ¤ì£¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main4Activity</span> <span class="kd">extends</span> <span class="n">c</span> <span class="o">{</span>
    <span class="nc">EditText</span> <span class="n">l</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main4</span><span class="o">);</span>
        <span class="n">a</span><span class="o">((</span><span class="nc">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">));</span>
        <span class="o">((</span><span class="nc">FloatingActionButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fab</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="nc">Main4Activity</span> <span class="n">a</span><span class="o">;</span>

            <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">r1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Snackbar</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"Replace with your own action"</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">a</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">).</span><span class="na">a</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"native-lib"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">l</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">l</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">stringFromJNI</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">native</span> <span class="nc">String</span> <span class="nf">stringFromJNI</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<p><br />
JNIê°€ ë‚˜ì™€ì„œ lib ê²½ë¡œë¥¼ í™•ì¸í•´ë³´ë‹ˆ, ì•„ë˜ì™€ ê°™ì´ so íŒŒì¼ì„ libë‚´ì— í¬í•¨í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/lib.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] lib directory</i></p>

<p>ë³„ë‹¤ë¥¸ ì—°ì‚° ì‘ì—…ì€ ë³´ì´ì§€ ì•Šê³  <code class="highlighter-rouge">stringFromJNI()</code>ë¥¼ í†µí•´ JNI()ë¡œ ë¶€í„° ê°’ì„ ë¿Œë ¤ì£¼ê³  ìˆìœ¼ë¯€ë¡œ Main4Activityê°€ ì‹¤í–‰ë§Œ ëœë‹¤ë©´, í•´ë‹¹ ë‚´ìš©ì´ settext ë˜ì–´ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ë¿Œë ¤ì§€ëŠ” ê°’ì€ ì•„ë§ˆ, flagê°€ ë˜ì§€ ì•Šì„ê¹Œ ìƒê°ì´ ë˜ì—ˆë‹¤.</p>

<p>Main4Activity class ë¥¼ ë¨¼ì € ë„ì›Œ JNI()ë¡œë¶€í„° í˜¸ì¶œë˜ëŠ” Textë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ, ì•„ë˜ì™€ ê°™ì´ MainActivityë¡œ ì¡í˜€ìˆëŠ” Entrypointë¥¼ Main4Activityë¡œ ë³€ê²½í•˜ë„ë¡ í•œë‹¤.</p>

<p><img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/before.png" alt="" />
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/after.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] fix AndroidManifest.xml</i></p>

<p>XML ìˆ˜ì •ì„ í•œ ë’¤ì—ëŠ”, apktoolì„ ì´ìš©í•´ ìˆ˜ì •ëœ apkë¥¼ ì¬ë¹Œë“œ í•œë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Codegate_CTF/ë¬¸ì œë°±ì—…/[Rev]Welcome to droidî‚°
î‚° apktool b droid/
I: Using Apktool 2.3.1
I: Checking whether sources has changed...
I: Smaling smali folder into classes.dex...
I: Checking whether resources has changed...
I: Building resources...
S: WARNING: Could not write to <span class="o">(</span>/Users/Mac/Library/apktool/framework<span class="o">)</span>, using /var/folders/t_/3_spx9kn2j1072knxbnnwlvm0000gn/T/ instead...
S: Please be aware this is a volatile directory and frameworks could go missing, please utilize <span class="nt">--frame-path</span> <span class="k">if </span>the default storage directory is unavailable
I: Copying libs... <span class="o">(</span>/lib<span class="o">)</span>
I: Building apk file...
I: Copying unknown files/dir...
</code></pre></div></div>
<p><br /></p>

<p>ì •ìƒì ìœ¼ë¡œ ë¹Œë“œë˜ì—ˆë‹¤ë©´, apkì— ì„œëª…ì„ ìœ„í•´ í•„ìš”í•œ íŒŒì¼ì´ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì•„ë˜ sign.jarì„ ì´ìš©í•´ ë¹Œë“œëœ apk ì— ì„œëª…ì„ ìˆ˜í–‰í•œë‹¤. (https://github.com/appium/sign ì—ì„œ sign.jarì„ ë°›ì„ ìˆ˜ ìˆë‹¤. )</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Codegate_CTF/ë¬¸ì œë°±ì—…/[Rev]Welcome to droidî‚°
î‚° java <span class="nt">-jar</span> ~/Desktop/lib_temp/sign.jar ./droid/dist/droid.apk

 jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Codegate_CTF/ë¬¸ì œë°±ì—…/[Rev]Welcome to droidî‚°
î‚° <span class="nb">ls</span> ./droid/dist/
droid.apk   droid.s.apk
</code></pre></div></div>
<p><br /></p>

<p>ë³¸ë˜ ì•±ì„ ì‚­ì œí•˜ê³ , re-build ëœ apkë¥¼ ì¬ì„¤ì¹˜ í•œ ë’¤, ì‹¤í–‰í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ JNI()ë¡œë¶€í„° settext ëœ flag ë¬¸ìì—´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<img src="/assets/images/2018-02-06-Codegate-CTF-Welcome-to-droid-125/result.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] Main4Activity - flag</i></p>

<blockquote>
  <p>Wol!! awesome!! FLAG{W3<em>w3r3_Back_70</em>$3v3n7een!!!} hahahah!!</p>
</blockquote>

<p align="right"><strong>FLAG{W3_w3r3_Back_70_$3v3n7een!!!}</strong></p>
:ET