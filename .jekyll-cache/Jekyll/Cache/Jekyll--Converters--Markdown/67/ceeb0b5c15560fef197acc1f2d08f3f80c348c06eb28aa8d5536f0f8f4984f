I"‹;<h2 id="exercise">Exercise</h2>

<blockquote>
  <p>Download: Link
Service: nc 35.200.176.244 33338
author: komang4130</p>
</blockquote>

<p><img src="/assets/images/2018-02-09-AceBear-CTF-STEg-Challenge-996/exercise.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] exercise</i></p>

<h2 id="solution">Solution</h2>

<p>AceBear CTF ì—ì„œ ë‚˜ì™”ë˜ Forensic/MISC ë¶„ì•¼ ì¤‘, ë§ˆì§€ë§‰ í’€ì´ ë¬¸ì œ. JS ë¬¸ì œë‘ ë§ˆì°¬ê°€ì§€ë¡œ ëŒ€íšŒ ë‹¹ì‹œì—ëŠ” í•´ê²°í•˜ì§€ ëª»í–ˆë‹¤. ë¬¸ì œ ì œëª©ì— ëŒ€í•´ì„œ ì¡°ê¸ˆë§Œ ë” ê³ ì°°ì„ í–ˆì—ˆë”ë¼ë©´ í•´ê²°í•  ìˆ˜ ìˆì—ˆì„í…ë°â€¦</p>

<p>linkë¥¼ í†µí•´, ë°›ì€ rar íŒŒì¼ì„ ì••ì¶• í•´ì œí•˜ë©´, <code class="highlighter-rouge">flag_enc.png</code> íŒŒì¼ì„ í•˜ë‚˜ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="/assets/images/2018-02-09-AceBear-CTF-STEg-Challenge-996/flag_enc.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] flag_enc.png</i></p>

<p>ì´ë¯¸ì§€ë¥¼ ìì„¸íˆ ë³´ë©´, ì¢Œì¸¡ ìƒë‹¨ì— ê²€ì •ìƒ‰ pixel ì¼ë¶€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. ë‹¹ì—°íˆ, pixelì„ ì´ìš©í•œ steganography ë°©ì‹ì˜ LSB ë¡œ ì¸ì‹í•˜ê³  ì ‘ê·¼í–ˆì—ˆëŠ”ë° ë³„ì§“ì„ ë‹¤í•´ë„ ì˜ë¯¸ìˆëŠ” ë¬¸ìì—´ì„ í™•ì¸í•  ìˆ˜ ì—†ì—ˆë˜ê²Œ í° ë¬¸ì œì˜€ë˜ ê²ƒ ê°™ë‹¤.</p>

<p>ë¬¸ì œë¥¼ ë³´ë©´, nc ë¡œ socket ì ‘ì†í•  ìˆ˜ ìˆëŠ” server ê°€ í•˜ë‚˜ ì£¼ì–´ì§€ëŠ”ë°, ì ‘ì†í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ 16byteì˜ dataë¥¼ ë°›ì•„ base64ë¡œ  encode ëœ dataë¥¼ receiveí•  ìˆ˜ ìˆì—ˆë‹¤.
<img src="/assets/images/2018-02-09-AceBear-CTF-STEg-Challenge-996/data_recieve.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] encode data</i></p>

<p>decode í•˜ì—¬, í™•ì¸í•´ë³´ë©´ flag_encì™€ ë™ì¼í•œ ì´ë¯¸ì§€ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ìì„¸íˆ ë³´ë©´ ìƒë‹¨ì˜ pixel ìœ„ì¹˜ê°€ ì¡°ê¸ˆì”© ë‹¤ë¥´ë‹¤.
<img src="/assets/images/2018-02-09-AceBear-CTF-STEg-Challenge-996/file1.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] decode data</i></p>

<p>ì—¬ê¸°ì„œ ìƒê°ì˜ ì „í™˜ì´ ì¡°ê¸ˆ í•„ìš”í–ˆë‹¤. serverë¡œ ë¶€í„° ì–´ë–¤ ìœ ì˜ë¯¸í•œ ë°ì´í„°ë¥¼ ì–»ì–´ë‚¼ ìˆ˜ ìˆëŠ”ê°€ ê³ ë¯¼ì„ í•˜ë‹¤ê°€ ê²°êµ­, ì›ì ìœ¼ë¡œ ëŒì•„ê°€ flag_enc ë¡œë¶€í„° ì •ë³´ë¥¼ ì–»ì–´ë‚´ë ¤ í–ˆë˜ ê²ƒì´ ë°œëª©ì„ ì¡ì•˜ë‹¤..</p>

<p>ê²°ê³¼ì ìœ¼ë¡œ, ë¬¸ì œ ì œëª©ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ <code class="highlighter-rouge">STEg</code>, <code class="highlighter-rouge">flag_enc</code> ë¼ëŠ” ë¬¸ìì—´ì— ì£¼ëª©í•´ë³´ì. encë¼ëŠ” ë¬¸ìì—´ì€ ë¬´ì—‡ì¸ê°€ encrypt ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ê·¸ë ‡ë‹¤ë©´, ì–´ë–¤ ë¡œì§ì„ í†µí•´ dataê°€ encrypt ë˜ì—ˆë‹¤ëŠ” ê²ƒì¸ë° pixelê³¼ Imageë¥¼ Steganography ì ìš©í•˜ëŠ” ë°©ì‹ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” í•­ëª©ì€ ì£¼ë¡œ lsbì¼ ê²ƒì´ë‹¤.</p>

<p>ê¸°ì¡´ì— ì•Œê³  ìˆë˜ lsb ë°©ì‹ì€ ëª¨ë‘ ì´ìš©í•´ ë³´ì•˜ì§€ë§Œ ë³„ ì†Œë“ì€ ì—†ì—ˆê³ , êµ¬ê¸€ì„ ë’¤ì§€ë‹¤ê°€ Python ê³¼ ê´€ë ¨ëœ ë„êµ¬ì—ì„œ <code class="highlighter-rouge">Stepic</code>ë¼ëŠ” ê²ƒì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤. (Python Steganography ë¼ëŠ” ì–¸ê¸‰ë§Œ ìˆì—ˆì–´ë„â€¦ã…‚ã„·ã…‚ã„·)</p>

<p><img src="/assets/images/2018-02-09-AceBear-CTF-STEg-Challenge-996/stepic.png" alt="" /></p>
<p align="center"><i>[ê·¸ë¦¼] stepic stegano</i></p>

<p>ì—°ì†ëœ 3ê°œì˜ pixel ì— dataë¥¼ ì€ë‹‰í•˜ëŠ” ë°©ì‹ì˜ lsb ì¸ë°, code ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ unhide í•  ìˆ˜ ìˆë‹¤. (https://stackoverflow.com/questions/16838341/steganography-in-python-stepic)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">decode_imdata</span><span class="p">(</span><span class="n">imdata</span><span class="p">):</span>
    <span class="s">'''Given a sequence of pixels, returns an iterator of characters
    encoded in the image'''</span>

    <span class="n">imdata</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">byte</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">byte</span> <span class="o">|=</span> <span class="n">pixels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">byte</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
        <span class="n">byte</span> <span class="o">|=</span> <span class="n">pixels</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="nb">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pixels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>


<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'test'</span><span class="p">)</span>
<span class="n">data</span>  <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_imdata</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">getdata</span><span class="p">())).</span><span class="n">decode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span>
</code></pre></div></div>
<p><br /></p>

<p>ìœ„ codeë¡œ ì„œë²„ë¡œë¶€í„° ë°›ì€ <code class="highlighter-rouge">encode data</code>ì™€ <code class="highlighter-rouge">flag_enc.png</code>ë¥¼ unhide í–ˆì„ ë•Œ, ì•„ë˜ì™€ ê°™ì€ ë¬¸ìì—´ì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤. ë¬´ì—‡ì¸ê°€ ë³µí˜¸í™”ê°€ ëœë‹¤ëŠ” ì‚¬ì‹¤ì´ ì¼ë‹¨ ì‹¤ë§ˆë¦¬ì´ë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Acebear_CTF/Forensic:MISC/STEgî‚°
î‚° python ./steg.py
|vohenrbuq<span class="o">{</span>nxe
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Acebear_CTF/Forensic:MISC/STEgî‚°
î‚° python ./steg.py
53:<span class="o">)</span>~&gt;1&amp;v1z4hu
</code></pre></div></div>

<p>êµ³ì´, serverë¡œë¶€í„° encode dataë¥¼ ì£¼ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ? í•´ë‹¹ dataë¡œë¶€í„° ì•Œì•„ë‚´ì•¼í•  ê²ƒì´ ìˆë‹¤ëŠ” ë§ì´ë‹¤. <code class="highlighter-rouge">flag_enc.png</code>ë¡œë¶€í„° unhide í–ˆì„ ë•Œ, ë³„ ì†Œë“ì´ ì—†ì—ˆìœ¼ë¯€ë¡œ í•´ë‹¹ ê²°ê³¼ ê°’ì— ì˜í–¥ì„ ë¯¸ì¹ ë§Œí•œ í•­ëª©ì„ ì°¾ì•„ëƒˆì–´ì•¼ í–ˆë‹¤. (ì´ ë¶€ë¶„ì—ì„œë„ ê½¤ ë§ì€ ì‹œê°„ì„ ìŸì•˜ë‹¤.)</p>

<p>ì—¬ëŸ¬ data ë¥¼ server ë¡œ send í•˜ë‹¤ê°€, <code class="highlighter-rouge">\x00</code> ë¡œë§Œ 16byteë¥¼ ì±„ì›Œë³´ë‚´ê³  ë°›ì€ encode dataì— ëŒ€í•´ì„œ unhide í•œ ê²°ê³¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” string(<code class="highlighter-rouge">OMG_YOU_BREAK_IT</code>)ì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Acebear_CTF/Forensic:MISC/STEgî‚°
î‚° python <span class="nt">-c</span> â€œprint â€˜<span class="se">\x</span>00â€™<span class="k">*</span>16â€ | nc localhost 33338 | <span class="nb">base64</span> <span class="nt">-D</span> <span class="o">&gt;</span> tmp.png

jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Acebear_CTF/Forensic:MISC/STEgî‚°
î‚° python ./steg.py
OMG_YOU_BREAK_IT
</code></pre></div></div>

<p>ë˜ ì—¬ê¸°ì„œ, ì‚½ì§ˆí–ˆë˜ê²Œ Nullë¡œ ì–»ì€ ë¬¸ìì—´ ê¸¸ì´ëŠ” 16byteì¸ë° flag_enc.png ì—ì„œ ì–»ì€ ë¬¸ìì—´ ê¸¸ì´ëŠ” 14byteì´ë‹¤.. ê¸°ì™• ë‚´ëŠ”ê±° ê¸¸ì´ ì¢€ ë§ì¶°ì„œ ë‚´ì§€;; 14byte ê¹Œì§€ë§Œ ê°ê°ì˜ ë¬¸ìì—´ì„ xor í•  ê²½ìš° flagë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤;;;</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">decode_imdata</span><span class="p">(</span><span class="n">imdata</span><span class="p">):</span>
    <span class="s">'''Given a sequence of pixels, returns an iterator of characters
    encoded in the image'''</span>

    <span class="n">imdata</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">pixels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">imdata</span><span class="p">.</span><span class="nb">next</span><span class="p">()[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">byte</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">byte</span> <span class="o">|=</span> <span class="n">pixels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">byte</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
        <span class="n">byte</span> <span class="o">|=</span> <span class="n">pixels</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="nb">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pixels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>

<span class="k">def</span> <span class="nf">strxor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>


<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'flag_enc.png'</span><span class="p">)</span>
<span class="n">data</span>  <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_imdata</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">getdata</span><span class="p">())).</span><span class="n">decode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span>


<span class="n">im2</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'tmp.png'</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">decode_imdata</span><span class="p">(</span><span class="n">im2</span><span class="p">.</span><span class="n">getdata</span><span class="p">())).</span><span class="n">decode</span><span class="p">(</span><span class="s">'hex'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data2</span>


<span class="k">print</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="nb">ord</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">data2</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jsh05042@Macs-MacBook-Pro î‚° ~/Desktop/CTF/2018_Acebear_CTF/Forensic:MISC/STEgî‚°
î‚° python ./steg.py
53:<span class="o">)</span>~&gt;1&amp;v1z4hu
OMG_YOU_BREAK_IT
zStep1k_st3p1k!!
</code></pre></div></div>

<blockquote>
  <p>ì†”ì§íˆ, ë§ì¶”ë¼ê³  ë‚¸ ë¬¸ì œì¸ê°€ ì• ë§¤í•˜ë‹¤.. Forensicì´ ì•„ë‹ˆë¼ ê·¸ëƒ¥ MISC ëŠë‚Œ.. ì–´ê±°ì§€ë¡œ ë¼ì›Œ ë§Œë“  ë¬¸ì œ ëŠë‚Œì´ ë„ˆë¬´ ê°•í•˜ê³ , ì“¸ë° ì—†ëŠ” ì‚½ì§ˆì´ ë„ˆë¬´ ë§ì´ í•„ìš”í–ˆë‹¤â€¦;;</p>
</blockquote>

<p align="right"><strong>AceBear{zStep1k_st3p1k!!}</strong></p>
:ET